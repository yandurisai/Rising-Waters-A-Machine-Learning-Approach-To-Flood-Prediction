<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodGuard AI ‚Äì Flood Prediction System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #1565C0;
            --accent: #0288D1;
            --danger: #D32F2F;
            --success: #2E7D32;
        }
        body { background: #f0f4f8; font-family: 'Segoe UI', sans-serif; }
        .navbar { background: linear-gradient(135deg, var(--primary), var(--accent)); }
        .hero { background: linear-gradient(135deg, #0D47A1, #0288D1);
                color: white; padding: 3rem 0 2rem; text-align: center; }
        .hero h1 { font-size: 2.5rem; font-weight: 700; }
        .hero p { font-size: 1.15rem; opacity: 0.9; }
        .card { border: none; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .card-header { border-radius: 16px 16px 0 0 !important; font-weight: 600; }
        .form-label { font-weight: 500; color: #444; }
        .form-control, .form-select { border-radius: 8px; border: 1.5px solid #dde; }
        .form-control:focus, .form-select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(2,136,209,0.15); }
        .btn-predict {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; font-size: 1.1rem; font-weight: 600;
            border: none; border-radius: 12px; padding: 14px 40px;
            transition: all 0.3s; width: 100%;
        }
        .btn-predict:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(21,101,192,0.35); }
        .result-box { border-radius: 16px; padding: 2rem; text-align: center;
                      transition: all 0.4s; display: none; }
        .risk-badge { font-size: 1.8rem; font-weight: 700; letter-spacing: 1px; }
        .prob-circle { width: 130px; height: 130px; border-radius: 50%;
                       display: flex; align-items: center; justify-content: center;
                       margin: 0 auto; font-size: 2rem; font-weight: 800; color: white; }
        .metric-card { text-align: center; padding: 1.2rem; border-radius: 12px;
                       background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.07); }
        .metric-val { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .metric-lbl { color: #666; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }
        .rec-item { background: white; border-left: 4px solid var(--accent);
                    padding: 10px 16px; border-radius: 0 8px 8px 0; margin-bottom: 8px;
                    font-size: 0.95rem; }
        .section-title { font-size: 1.4rem; font-weight: 700; color: #1a1a2e; margin-bottom: 0.3rem; }
        .spinner-overlay { display: none; position: absolute; inset: 0; background: rgba(255,255,255,0.8);
                           border-radius: 16px; align-items: center; justify-content: center; z-index: 10; }
        @media (max-width: 768px) { .hero h1 { font-size: 1.7rem; } }
    </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand fw-bold fs-5" href="/"><i class="fas fa-water me-2"></i>FloodGuard AI</a>
        <div class="d-flex">
            <a href="/dashboard" class="btn btn-light btn-sm ms-2"><i class="fas fa-chart-bar me-1"></i>Dashboard</a>
        </div>
    </div>
</nav>

<!-- Hero -->
<div class="hero">
    <div class="container">
        <h1><i class="fas fa-shield-alt me-3"></i>Flood Prediction System</h1>
        <p>Machine Learning‚Äìpowered early warning using real-time weather &amp; environmental data</p>
        <div class="row justify-content-center mt-3 g-3">
            <div class="col-auto">
                <span class="badge bg-light text-dark px-3 py-2 fs-6">
                    <i class="fas fa-brain me-1 text-primary"></i>
                    Best Model: <strong>{{ metrics.best_model }}</strong>
                </span>
            </div>
            <div class="col-auto">
                <span class="badge bg-light text-dark px-3 py-2 fs-6">
                    <i class="fas fa-chart-line me-1 text-success"></i>
                    AUC: <strong>{{ "%.3f"|format(metrics.bootstrap_auc_mean) }}</strong>
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container py-4">
    <div class="row g-4">
        <!-- Input Form -->
        <div class="col-lg-7">
            <div class="card position-relative">
                <div class="spinner-overlay" id="loadingOverlay">
                    <div class="spinner-border text-primary" role="status"></div>
                </div>
                <div class="card-header bg-primary text-white py-3">
                    <i class="fas fa-sliders-h me-2"></i>Environmental Parameters
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        <!-- Rainfall -->
                        <div class="col-12"><p class="section-title mb-0">üåßÔ∏è Rainfall Data</p><hr class="mt-1"></div>
                        <div class="col-md-4">
                            <label class="form-label">Current Rainfall (mm)</label>
                            <input type="number" class="form-control" id="rainfall_mm" value="35" min="0" max="500" step="0.1">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">3-Day Avg (mm)</label>
                            <input type="number" class="form-control" id="rainfall_3day_avg" value="22" min="0" step="0.1">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">7-Day Avg (mm)</label>
                            <input type="number" class="form-control" id="rainfall_7day_avg" value="18" min="0" step="0.1">
                        </div>

                        <!-- Hydrology -->
                        <div class="col-12"><p class="section-title mb-0">üåä Hydrology</p><hr class="mt-1"></div>
                        <div class="col-md-6">
                            <label class="form-label">River Level (m)</label>
                            <input type="number" class="form-control" id="river_level_m" value="5.5" min="0" max="20" step="0.1">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Soil Moisture (%)</label>
                            <input type="number" class="form-control" id="soil_moisture_pct" value="55" min="0" max="100">
                        </div>

                        <!-- Weather -->
                        <div class="col-12"><p class="section-title mb-0">üå°Ô∏è Weather Conditions</p><hr class="mt-1"></div>
                        <div class="col-md-4">
                            <label class="form-label">Temperature (¬∞C)</label>
                            <input type="number" class="form-control" id="temperature_c" value="28" min="-20" max="55">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Humidity (%)</label>
                            <input type="number" class="form-control" id="humidity_pct" value="75" min="0" max="100">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Wind Speed (km/h)</label>
                            <input type="number" class="form-control" id="wind_speed_kmh" value="15" min="0">
                        </div>

                        <!-- Terrain -->
                        <div class="col-12"><p class="section-title mb-0">üèîÔ∏è Terrain & Infrastructure</p><hr class="mt-1"></div>
                        <div class="col-md-4">
                            <label class="form-label">Elevation (m)</label>
                            <input type="number" class="form-control" id="elevation_m" value="15" min="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Distance to River (km)</label>
                            <input type="number" class="form-control" id="distance_to_river_km" value="1.5" min="0" step="0.1">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Drainage Quality</label>
                            <select class="form-select" id="drainage_quality">
                                <option value="0">Poor</option>
                                <option value="1" selected>Medium</option>
                                <option value="2">Good</option>
                            </select>
                        </div>

                        <!-- Presets -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">Quick Scenarios:</label>
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="btn btn-outline-success btn-sm" onclick="setScenario('safe')">
                                    <i class="fas fa-check-circle me-1"></i>Safe
                                </button>
                                <button class="btn btn-outline-warning btn-sm" onclick="setScenario('moderate')">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Moderate Risk
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="setScenario('flood')">
                                    <i class="fas fa-bolt me-1"></i>Flood Conditions
                                </button>
                            </div>
                        </div>

                        <div class="col-12 mt-3">
                            <button class="btn-predict" onclick="predict()">
                                <i class="fas fa-search me-2"></i>Predict Flood Risk
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Panel -->
        <div class="col-lg-5">
            <div class="card mb-4">
                <div class="card-header bg-dark text-white py-3">
                    <i class="fas fa-chart-pie me-2"></i>Prediction Result
                </div>
                <div class="card-body p-4">
                    <div id="resultBox" class="result-box">
                        <div class="prob-circle mb-3" id="probCircle">
                            <span id="probText">--</span>
                        </div>
                        <div class="risk-badge mb-2" id="riskBadge">--</div>
                        <p class="text-muted mb-3" id="riskDesc">--</p>
                        <div class="progress mb-3" style="height: 10px; border-radius: 10px;">
                            <div class="progress-bar" id="riskBar" style="width: 0%; border-radius: 10px;"></div>
                        </div>
                        <h6 class="text-start fw-bold mb-2"><i class="fas fa-clipboard-list me-2"></i>Recommendations</h6>
                        <div id="recommendations"></div>
                    </div>
                    <div id="noResult" class="text-center py-4 text-muted">
                        <i class="fas fa-water fa-3x mb-3 opacity-25"></i>
                        <p>Fill in the parameters and click <strong>Predict</strong> to get the flood risk assessment.</p>
                    </div>
                </div>
            </div>

            <!-- Model Metrics -->
            <div class="card">
                <div class="card-header bg-info text-white py-3">
                    <i class="fas fa-trophy me-2"></i>Model Performance
                </div>
                <div class="card-body p-3">
                    <p class="text-center text-muted small mb-3">{{ metrics.best_model }}</p>
                    <div class="row g-2">
                        {% set m = metrics.models[metrics.best_model] %}
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-val">{{ "%.1f"|format(m.accuracy * 100) }}%</div>
                                <div class="metric-lbl">Accuracy</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-val">{{ "%.1f"|format(m.f1 * 100) }}%</div>
                                <div class="metric-lbl">F1 Score</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-val">{{ "%.3f"|format(metrics.bootstrap_auc_mean) }}</div>
                                <div class="metric-lbl">AUC (Bootstrap)</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-val">{{ "%.1f"|format(m.recall * 100) }}%</div>
                                <div class="metric-lbl">Recall</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-center text-muted small mt-2 mb-0">
                        95% CI: {{ "%.3f"|format(metrics.bootstrap_ci_lower) }} ‚Äì {{ "%.3f"|format(metrics.bootstrap_ci_upper) }}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="bg-dark text-white text-center py-3 mt-4">
    <small><i class="fas fa-water me-1"></i>FloodGuard AI ‚Äî Flood Prediction using Machine Learning</small>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
const scenarios = {
    safe: { rainfall_mm:5, rainfall_3day_avg:3, rainfall_7day_avg:2, river_level_m:2, temperature_c:26,
            humidity_pct:55, wind_speed_kmh:8, soil_moisture_pct:25, elevation_m:80,
            distance_to_river_km:10, drainage_quality:2 },
    moderate: { rainfall_mm:28, rainfall_3day_avg:20, rainfall_7day_avg:15, river_level_m:5,
                temperature_c:29, humidity_pct:72, wind_speed_kmh:18, soil_moisture_pct:58,
                elevation_m:20, distance_to_river_km:2.5, drainage_quality:1 },
    flood: { rainfall_mm:65, rainfall_3day_avg:50, rainfall_7day_avg:38, river_level_m:9.5,
             temperature_c:27, humidity_pct:92, wind_speed_kmh:35, soil_moisture_pct:85,
             elevation_m:5, distance_to_river_km:0.5, drainage_quality:0 }
};

function setScenario(name) {
    const s = scenarios[name];
    Object.entries(s).forEach(([k, v]) => {
        const el = document.getElementById(k);
        if (el) el.value = v;
    });
}

async function predict() {
    document.getElementById('loadingOverlay').style.display = 'flex';
    const payload = {};
    ['rainfall_mm','rainfall_3day_avg','rainfall_7day_avg','river_level_m','temperature_c',
     'humidity_pct','wind_speed_kmh','soil_moisture_pct','elevation_m',
     'distance_to_river_km','drainage_quality'].forEach(id => {
        payload[id] = document.getElementById(id).value;
    });
    try {
        const res = await fetch('/predict', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        document.getElementById('loadingOverlay').style.display = 'none';
        if (data.error) { alert('Error: ' + data.error); return; }
        showResult(data);
    } catch(e) {
        document.getElementById('loadingOverlay').style.display = 'none';
        alert('Prediction failed: ' + e.message);
    }
}

function showResult(data) {
    document.getElementById('noResult').style.display = 'none';
    const box = document.getElementById('resultBox');
    box.style.display = 'block';
    box.style.backgroundColor = data.risk_color + '18';
    box.style.border = `2px solid ${data.risk_color}`;

    const circle = document.getElementById('probCircle');
    circle.style.background = `linear-gradient(135deg, ${data.risk_color}, ${data.risk_color}aa)`;
    document.getElementById('probText').textContent = data.probability + '%';

    document.getElementById('riskBadge').textContent = data.risk_level + ' Risk';
    document.getElementById('riskBadge').style.color = data.risk_color;

    const descs = { Low:'No immediate flood threat detected.', Moderate:'Elevated flood risk ‚Äî monitor conditions.',
                    High:'High flood risk ‚Äî prepare for action.', Critical:'Critical flood threat ‚Äî immediate action required!' };
    document.getElementById('riskDesc').textContent = descs[data.risk_level] || '';

    const bar = document.getElementById('riskBar');
    bar.style.width = data.probability + '%';
    bar.style.backgroundColor = data.risk_color;

    const recDiv = document.getElementById('recommendations');
    recDiv.innerHTML = data.recommendations.map(r =>
        `<div class="rec-item">${r}</div>`).join('');
}
</script>
</body>
</html>
